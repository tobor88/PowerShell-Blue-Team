<#
.NAME
    Resolve-CVE-2017-8529


.SYNOPSIS
    This cmdlet is used to added the registry value required to resolve CVE-2017-8529.
    https://www.cvedetails.com/cve/CVE-2017-8529/


.SYNTAX
    Resolve-CVE-2017-8529 [<CommonParameters>]
    

.NOTES
    Author: Rob Osborne
    Alias: tobor
    Contact: rosborne@osbornepro.com


.INPUTS
    None
        You cannot pipe input to this cmdlet.


.OUTPUTS
    System.Management.Automation.PSCustomObject
        New-ItemProperty returns a custom object that contains the new property.


.LINK
    https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-8529
    https://www.cvedetails.com/cve/CVE-2017-8529/
    https://github.com/tobor88
    https://www.powershellgallery.com/profiles/tobor
    https://roberthosborne.com

#>
Function Resolve-CVE-2017-8529 {
    [CmdletBinding()]
        param()

    Write-Verbose "[*] Checking OS Architecture value"

    Try
    {

        $OS = (Get-CimInstance -ClassName 'CIM_OperatingSystem').OSArchitecture

    }  # End Try
    Catch
    {

        $OS = (Get-WmiObject -ClassName'CIM_OperatingSystem').OSArchitecture

    }  # End Catch

    If (!($OS))
    {

        Try
        {

            $OS = (wmic os get OSArchitecture)[2]

        }  # End Try
        Catch
        {

            $IsIt = [System.Environment]::Is64BitOperatingSystem

            If ($IsIt)
            {

                $OS = "64-bit"

            }  # End If
            Else
            {

                $OS = "32-bit"

            }  # End Else

        }  # End Catch

    }  # End If
 
    $Path = 'HKLM:\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl' 'HKLM:\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl'
    $Key = 'FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX'

    ForEach ($Item in $Path)
    {
    
        If (!(Test-Path -Path "$Item\$Key"))
        {

            Write-Verbose "Creating registry key value: $Key"

            New-Item -Path "$Item" -Name $Key

        }  # If
        Else
        {

            Write-Verbose "[*] Registry Key location exists: $Item\$Key"

        }  # End Else


        If (1 -ne (Get-ItemProperty -Path "$Item\$Key" | Select-Object -ExpandProperty 'iexplorer.exe'))
        {

            Write-Verbose "[*] Setting registry DWORD value"

            New-ItemProperty -Path "$Item\$Key" -Name "iexplorer.exe" -Value 1 -PropertyType DWORD

        }  # End If
        Else
        {

            Write-Output "[i] Registry Value is already set correctly"

        } # End Else
        
    }  # End ForEach

}  # End Function Resolve-CVE-2017-8529
